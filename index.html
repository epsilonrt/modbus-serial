<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Modbus-Serial: Modbus Library for Arduino</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="modbus.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Modbus-Serial
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Modbus Library for Arduino </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a>Over Serial Line Implementation RTU (OSI 2/OSI 1)</p>
<p><a href="https://github.com/epsilonrt/modbus-serial/releases"><img src="https://img.shields.io/github/v/release/epsilonrt/modbus-serial?include_prereleases" alt="GitHub release (latest by date including pre-releases)" class="inline"/></a> <a href="https://registry.platformio.org/libraries/epsilonrt/modbus-serial"><img src="https://badges.registry.platformio.org/packages/epsilonrt/library/modbus-serial.svg" alt="PlatformIO Registry" style="pointer-events: none;" class="inline"/></a></p>
<p><a href="https://www.arduino.cc/"><img src="https://img.shields.io/badge/Framework-Arduino-blue" alt="Framework" class="inline"/></a> <a href="https://github.com/epsilonrt/modbus-serial/actions/workflows/build_uno.yml"><img src="https://github.com/epsilonrt/modbus-serial/actions/workflows/build_uno.yml/badge.svg" alt="Uno" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/epsilonrt/modbus-serial/actions/workflows/build_due.yml"><img src="https://github.com/epsilonrt/modbus-serial/actions/workflows/build_due.yml/badge.svg" alt="Due" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/epsilonrt/modbus-serial/actions/workflows/build_mega.yml"><img src="https://github.com/epsilonrt/modbus-serial/actions/workflows/build_mega.yml/badge.svg" alt="Mega" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/epsilonrt/modbus-serial/actions/workflows/build_nano33iot.yml"><img src="https://github.com/epsilonrt/modbus-serial/actions/workflows/build_nano33iot.yml/badge.svg" alt="Nano33IoT" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/epsilonrt/modbus-serial/actions/workflows/build_esp8266.yml"><img src="https://github.com/epsilonrt/modbus-serial/actions/workflows/build_esp8266.yml/badge.svg" alt="Esp8266" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/epsilonrt/modbus-serial/actions/workflows/build_esp32.yml"><img src="https://github.com/epsilonrt/modbus-serial/actions/workflows/build_esp32.yml/badge.svg" alt="Esp32" style="pointer-events: none;" class="inline"/></a></p>
<hr  />
<p>This library allows your Arduino to communicate via Modbus protocol. The Modbus is a master-slave protocol used in industrial automation and can be used in other areas, such as home automation.</p>
<p>In the current version the library allows the Arduino operate <b>as a slave</b>, supporting Modbus over Serial Line RTU.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
How to</h1>
<p>There are four classes corresponding to five headers that may be used:</p>
<ul>
<li><a href="http://github.com/epsilonrt/modbus-arduino">Modbus</a> - Base Library</li>
<li><a class="el" href="class_modbus_serial.html" title="Modbus over serial line Class.">ModbusSerial</a> - Modbus Serial RTU Library (this repository) <br  />
</li>
<li><a href="https://github.com/epsilonrt/modbus-ethernet">ModbusEthernet</a> - Modbus TCP Library (standard Ethernet Shield) <br  />
</li>
<li><a href="https://github.com/epsilonrt/modbus-ethercard">ModbusEthercard</a> - Modbus TCP Library (for ENC28J60 chip) <br  />
</li>
<li><a href="https://github.com/epsilonrt/modbus-esp8266at">ModbusEsp8266AT</a> - Modbus IP Library (for ESP8266 chip with AT firmware) <br  />
</li>
</ul>
<p>By opting for Modbus Serial or Modbus TCP you must include in your sketch the corresponding header, eg: </p><pre class="fragment">#include &lt;ModbusSerial.h&gt;
</pre> <h1><a class="anchor" id="autotoc_md3"></a>
ModbusSerial</h1>
<p>There are five examples that can be accessed from the Arduino IDE or Visual Studio Code with Platformio, once you have installed the library. Let's look at the example Lamp.ino (only the parts concerning Modbus will be commented): </p><pre class="fragment">#include &lt;ModbusSerial.h&gt;
</pre><p> Inclusion of the necessary header. </p><pre class="fragment">const int Lamp1Coil = 0;
</pre><p> Sets the Modbus register to represent a lamp or LED. This value is the offset (0-based) to be placed in its supervisory or testing software. Note that if your software uses offsets 1-based the set value there should be 1, for this example. </p><pre class="fragment">ModbusSerial mb (Serial, SlaveId);
</pre><p> Create the mb instance (<a class="el" href="class_modbus_serial.html" title="Modbus over serial line Class.">ModbusSerial</a>) to be used with the serial port <code>Serial</code>. Note that the serial port is passed as reference, which permits the use of other serial ports in other Arduino models, also ets the slave Id.</p>
<p>If you are using RS-485 driver, the configuration of another pin to control transmission/reception is required, this pin would be connected to the DE and /RE pins of the driver. This is done as follows: </p><pre class="fragment">const int TxenPin = 4;
// ....
ModbusSerial mb (Serial, SlaveId, TxenPin);
</pre><p> In this case, the pin 4 will be used to control TX/RX (DE must be connected with /RE). </p><pre class="fragment">Serial.begin (Baudrate, MB_PARITY_EVEN);
while (! Serial)
  ;
</pre><p> Configure the serial port and wait for it to be ready.</p>
<p>To simplify the modification of the port, you can define a macro in the following way : </p><pre class="fragment">#define MySerial Serial // define serial port used, Serial most of the time, or Serial1, Serial2 ... if available
</pre><p> Then the block above can be written as follows : </p><pre class="fragment">ModbusSerial mb (MySerial, SlaveId, TxenPin);

void setup() {

  MySerial.begin (Baudrate, MB_PARITY_EVEN); // prefer this line in accordance with the modbus standard.
  while (! MySerial)
    ;

  mb.config (Baudrate);
</pre><p> The last line configures the <a class="el" href="class_modbus_serial.html" title="Modbus over serial line Class.">ModbusSerial</a> object. </p><pre class="fragment">mb.addCoil (Lamp1Coil);
</pre><p> Adds the register type Coil (digital output) that will be responsible for activating the LED or lamp and verify their status. The library allows you to set an initial value for the register: </p><pre class="fragment">mb.addCoil (Lamp1Coil, true);
</pre><p> In this case the register is added and set to true. If you use the first form the default value is false. </p><pre class="fragment">mb.task ();
</pre><p> This method makes all magic, answering requests and changing the registers if necessary, it should be called only once, early in the loop. </p><pre class="fragment">digitalWrite (LedPin, mb.Coil (Lamp1Coil));
</pre><p> Finally the value of Lamp1Coil register is used to drive the lamp or LED.</p>
<p>In much the same way, the other examples show the use of other methods available in the library: </p><pre class="fragment">void addCoil (offset word, bool value)
void addHreg (offset word, word value)
void addIsts (offset word, bool value)
void addIreg (offset word, word value)
</pre><p> Adds registers and configures initial value if specified. </p><pre class="fragment">bool Coil (offset word, bool value)
bool Hreg (offset word, word value)
bool Ists (offset word, bool value)
bool IReg (offset word, word value)
</pre><p> Sets a value to the register. </p><pre class="fragment">bool Coil (offset word)
word Hreg  (word offset)
bool Ists (offset word)
word IReg (word offset)
</pre><p> Returns the value of a register.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Contributions</h1>
<p><a href="http://github.com/epsilonrt/modbus-arduino">http://github.com/epsilonrt/modbus-arduino</a> <br  />
 prof (at) andresarmento (dot) com <br  />
 epsilonrt (at) gmail (dot) com <br  />
</p>
<h1><a class="anchor" id="autotoc_md5"></a>
License</h1>
<p>The code in this repo is licensed under the BSD New License. See LICENSE for more info. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
